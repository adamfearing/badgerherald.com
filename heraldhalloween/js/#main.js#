(function($) {
  'use strict';

  // Super-hacky function for formatting text better in the tweets
  function format_tweet(text) {
    // Links
    text = text.replace(/(https?:\/\/[^\s]+)/gi,
                        '<a href="$1">$1</a>');
    // #tags
    text = text.replace(/(#[A-Za-z_]\w*)/gi, function($1) {
      var escaped_tag = encodeURIComponent($1);
      return '<a href="http://twitter.com/search?q='
        + escaped_tag
        + '">' + $1 + '</a>';
    });
    // @mentions
    text = text.replace(/(@\w+)/gi, function($1) {
      var username = $1.substr(1);
      return '<a href="http://twitter.com/' + username + '">' + $1 + '</a>';
    });
    return text;
  }

  function make_post(data) {
    var post = $('<div>').attr('class', 'post');
    post.attr('id', data.id);
    var costume_img = $('<div>').attr('class', 'costume-img');

    var tweet = $('<div>').attr('class', 'tweet');

    var meta = '<p><a href="http://twitter.com/'
      + data.user.screen_name + '">' + data.user.name + '</a>';

    var body = '<p>' + data.text + '</p>';
../../.
    async.series([function(callback) {
      if (!data.avi) {
        callback();
      } else {
        var avi = $('<img/>').attr('src', data.avi);
        avi.on('load', function() {
          callback();
        });
      }
    }, function(callback) {
      if (!data.img) {
        callback();
      } else {
        var img = $('<img/>').attr('class', 'avatar').attr('src', data.img);
        img.on('load', function() {
          callback();
        });
      }
    }], function(err) {
      if (err) {
        console.log(err);
      }
      if (img) {
        costume_img.html(img);
      }
      
      
    });
  }
  
  var socket = io.connect('http://localhost:3000');
  socket.on('halloween', function(data) {
    console.log(data);
    $('#pics').append($('<p>').text(data.text));
  });
  console.log(socket);
})(jQuery);
